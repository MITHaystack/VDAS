<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Mark6: FileWriter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Mark6</div>
   <div id="projectbrief">Mark6 VLBI data acquisition software.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">FileWriter Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="FileWriter" --><!-- doxytag: inherits="Threaded" -->
<p><code>#include &lt;<a class="el" href="file__writer_8h_source.html">file_writer.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for FileWriter:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_file_writer.png" usemap="#FileWriter_map" alt=""/>
  <map id="FileWriter_map" name="FileWriter_map">
<area href="class_threaded.html" alt="Threaded" shape="rect" coords="0,0,67,24"/>
</map>
 </div></div>

<p><a href="class_file_writer-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#ae35a8819039ac43d6d1bc6448bf5d9ca">FileWriter</a> (const int id, const int write_block_size, const int write_blocks, const std::string &amp;capture_file, const int poll_timeout, <a class="el" href="class_stats_writer.html">StatsWriter</a> *const sw, const double command_interval)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae5490307dcaf9237f4c1b8b8df433e03"></a><!-- doxytag: member="FileWriter::~FileWriter" ref="ae5490307dcaf9237f4c1b8b8df433e03" args="()" -->
virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#ae5490307dcaf9237f4c1b8b8df433e03">~FileWriter</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a49837b1a8ddfa509932e66830327c92f"></a><!-- doxytag: member="FileWriter::start" ref="a49837b1a8ddfa509932e66830327c92f" args="()" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a49837b1a8ddfa509932e66830327c92f">start</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the main processing loop <a class="el" href="class_file_writer.html#adef323aa1b01c54dcdf26a7c67ba0360" title="Main processing loop.">run()</a> in its own thread of execution. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="add364eb1a603167a70713eb87d90ee52"></a><!-- doxytag: member="FileWriter::join" ref="add364eb1a603167a70713eb87d90ee52" args="()" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#add364eb1a603167a70713eb87d90ee52">join</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the main processing loop/thread to exit. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#ad0a98ab099aaca2f64875ace82fadd55">cmd_stop</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a54470d110cd9e50add4a18808ef162cf">cmd_write_to_disk</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3cb740ffb3e76673dd5b8f2f02364814"></a><!-- doxytag: member="FileWriter::open" ref="a3cb740ffb3e76673dd5b8f2f02364814" args="()" -->
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a3cb740ffb3e76673dd5b8f2f02364814">open</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Custom API. Open capture file on disk. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a66f2225935e8b52087c18bb55e3de25f"></a><!-- doxytag: member="FileWriter::close" ref="a66f2225935e8b52087c18bb55e3de25f" args="()" -->
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a66f2225935e8b52087c18bb55e3de25f">close</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Custom API. Close capture file on disk. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#aed0ee15de36255a2883b5f15c710848c">write</a> (boost::uint8_t *buf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae0b706212febc337c6569c784caeadef"></a><!-- doxytag: member="FileWriter::write_unbuffered" ref="ae0b706212febc337c6569c784caeadef" args="(boost::uint8_t *buf, const boost::uint32_t len)" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><b>write_unbuffered</b> (boost::uint8_t *buf, const boost::uint32_t len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acfb6a6d1dbfe11e2b95cb71cf8100b5a"></a><!-- doxytag: member="FileWriter::malloc_buffer" ref="acfb6a6d1dbfe11e2b95cb71cf8100b5a" args="()" -->
boost::uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>malloc_buffer</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad299a4d3f66400eb4b0511c1532f524a"></a><!-- doxytag: member="FileWriter::free_buffer" ref="ad299a4d3f66400eb4b0511c1532f524a" args="(boost::uint8_t *buf)" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><b>free_buffer</b> (boost::uint8_t *buf)</td></tr>
<tr><td colspan="2"><h2><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <b>IDLE</b>, 
<b>WRITE_TO_DISK</b>, 
<b>STOP</b>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The state of the object. <br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adef323aa1b01c54dcdf26a7c67ba0360"></a><!-- doxytag: member="FileWriter::run" ref="adef323aa1b01c54dcdf26a7c67ba0360" args="()" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#adef323aa1b01c54dcdf26a7c67ba0360">run</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Main processing loop. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#aad41d68744863310432de1b9e046023c">handle_stop</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab5f5d4e17db6f25cd6adc65ffbdb1832"></a><!-- doxytag: member="FileWriter::handle_idle" ref="ab5f5d4e17db6f25cd6adc65ffbdb1832" args="()" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#ab5f5d4e17db6f25cd6adc65ffbdb1832">handle_idle</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Command handler. Handles the IDLE state. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#ab70890152eb8fc3cfd06fb9481ea9cd0">handle_write_to_disk</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#ae596120f6d887f38bcca891b31cfc441">write_block</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aedf3b9551969f84ce150d464cab00f84"></a><!-- doxytag: member="FileWriter::_WRITE_BLOCK_SIZE" ref="aedf3b9551969f84ce150d464cab00f84" args="" -->
const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#aedf3b9551969f84ce150d464cab00f84">_WRITE_BLOCK_SIZE</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The size of blocks to be written to disc. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3d13acff97b66620f99bc9c6fb352f31"></a><!-- doxytag: member="FileWriter::_WRITE_BLOCKS" ref="a3d13acff97b66620f99bc9c6fb352f31" args="" -->
const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a3d13acff97b66620f99bc9c6fb352f31">_WRITE_BLOCKS</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum number of write blocks that can be buffered at any one time. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adbde79fddb4ab604cd02dcb189f0b2fa"></a><!-- doxytag: member="FileWriter::_POLL_TIMEOUT" ref="adbde79fddb4ab604cd02dcb189f0b2fa" args="" -->
const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#adbde79fddb4ab604cd02dcb189f0b2fa">_POLL_TIMEOUT</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The timeout for blocking operations. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a823e30da8d24cec85a15bb8947ec7d26"></a><!-- doxytag: member="FileWriter::_pfd" ref="a823e30da8d24cec85a15bb8947ec7d26" args="" -->
struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a823e30da8d24cec85a15bb8947ec7d26">_pfd</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Encapsulates the file descriptor of the file this object manages. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::list&lt; boost::uint8_t * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#aca52ee3a5dcc8649a1aa702ba6de6af6">_write_bufs</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5f1926d606cd889230ca72241e57dffc"></a><!-- doxytag: member="FileWriter::_free_bufs" ref="a5f1926d606cd889230ca72241e57dffc" args="" -->
std::list&lt; boost::uint8_t * &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>_free_bufs</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aebfbd3e791e8dc53356c22932aa83d44"></a><!-- doxytag: member="FileWriter::_state" ref="aebfbd3e791e8dc53356c22932aa83d44" args="" -->
enum FileWriter:: { ... } &#160;</td><td class="memItemRight" valign="bottom"><b>_state</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a39285179310fa0e5424b9b53dd722f64"></a><!-- doxytag: member="FileWriter::_write_bufs_mutex" ref="a39285179310fa0e5424b9b53dd722f64" args="" -->
boost::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a39285179310fa0e5424b9b53dd722f64">_write_bufs_mutex</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex that protects the write buffer from multi-threaded access. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac7364b6382201cccb01416a3db104ea5"></a><!-- doxytag: member="FileWriter::_free_bufs_mutex" ref="ac7364b6382201cccb01416a3db104ea5" args="" -->
boost::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#ac7364b6382201cccb01416a3db104ea5">_free_bufs_mutex</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex that protects free list from multi-threaded access. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">boost::condition_variable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a094970dbaba07c145b26b9fce12951e8">_read_cond</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">boost::condition_variable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#af0d0e6ad7c4b2f7ce920540728fbcb20">_write_cond</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae9cb41b36aa8ba14a5ead1f1b08272a2"></a><!-- doxytag: member="FileWriter::_capture_file" ref="ae9cb41b36aa8ba14a5ead1f1b08272a2" args="" -->
const std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#ae9cb41b36aa8ba14a5ead1f1b08272a2">_capture_file</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the file data will be written to. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_stats_writer.html">StatsWriter</a> *const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_file_writer.html#a77bde646bee4389994613ae0663a13ca">_sw</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Manages the high speed writing of data to file. Includes a circular buffer for storing buffers to be written, as well as a state machine that controls the operation of the thread. The class is an "active" object that runs in its own thread of execution. External objects can interact with it via the <a class="el" href="class_file_writer.html#a49837b1a8ddfa509932e66830327c92f" title="Start the main processing loop run() in its own thread of execution.">start()</a>, <a class="el" href="class_file_writer.html#add364eb1a603167a70713eb87d90ee52" title="Wait for the main processing loop/thread to exit.">join()</a>, cmd_XXX(), <a class="el" href="class_file_writer.html#aed0ee15de36255a2883b5f15c710848c">write()</a>, <a class="el" href="class_file_writer.html#a3cb740ffb3e76673dd5b8f2f02364814" title="Custom API. Open capture file on disk.">open()</a>, and <a class="el" href="class_file_writer.html#a66f2225935e8b52087c18bb55e3de25f" title="Custom API. Close capture file on disk.">close()</a> methods. </p>

<p>Definition at line <a class="el" href="file__writer_8h_source.html#l00056">56</a> of file <a class="el" href="file__writer_8h_source.html">file_writer.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae35a8819039ac43d6d1bc6448bf5d9ca"></a><!-- doxytag: member="FileWriter::FileWriter" ref="ae35a8819039ac43d6d1bc6448bf5d9ca" args="(const int id, const int write_block_size, const int write_blocks, const std::string &amp;capture_file, const int poll_timeout, StatsWriter *const sw, const double command_interval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FileWriter::FileWriter </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>write_block_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>write_blocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>capture_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>poll_timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_stats_writer.html">StatsWriter</a> *const&#160;</td>
          <td class="paramname"><em>sw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>command_interval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Constructor </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>A unique id for this object. Used for logging. </td></tr>
    <tr><td class="paramname">write_block_size</td><td>The size of the indidivual write blocks to be written to disk. WRITE_BLOCK bytes of data will be written to disk each time <a class="el" href="class_file_writer.html#ae596120f6d887f38bcca891b31cfc441">write_block()</a> is called. </td></tr>
    <tr><td class="paramname">write_blocks</td><td>The total number of write blocks to buffer internally. </td></tr>
    <tr><td class="paramname">poll_timeout\xrefitem</td><td>todo 1. </td></tr>
    <tr><td class="paramname">sw</td><td>A pointer to a <a class="el" href="class_stats_writer.html">StatsWriter</a> object. Performance data will be logged using this object. </td></tr>
    <tr><td class="paramname">command_interval</td><td>The main executin thread in <a class="el" href="class_file_writer.html#adef323aa1b01c54dcdf26a7c67ba0360" title="Main processing loop.">run()</a> will attempt to check for new commands every command_interval seconds. The actual interval between checks may be larger than this if the execution thread spends longer than command_interval processing individual tasks. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file__writer_8cc_source.html#l00046">46</a> of file <a class="el" href="file__writer_8cc_source.html">file_writer.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                             :
  <a class="code" href="class_threaded.html#a6236a842ddac09f974c58e17680d41c0">Threaded</a>(<span class="keywordtype">id</span>, command_interval),
  <a class="code" href="class_file_writer.html#aedf3b9551969f84ce150d464cab00f84" title="The size of blocks to be written to disc.">_WRITE_BLOCK_SIZE</a>(write_block_size),
  <a class="code" href="class_file_writer.html#a3d13acff97b66620f99bc9c6fb352f31" title="The maximum number of write blocks that can be buffered at any one time.">_WRITE_BLOCKS</a>(write_blocks),
  <a class="code" href="class_file_writer.html#adbde79fddb4ab604cd02dcb189f0b2fa" title="The timeout for blocking operations.">_POLL_TIMEOUT</a>(poll_timeout),
  <a class="code" href="class_file_writer.html#a77bde646bee4389994613ae0663a13ca">_sw</a>(sw),
  <a class="code" href="class_file_writer.html#a823e30da8d24cec85a15bb8947ec7d26" title="Encapsulates the file descriptor of the file this object manages.">_pfd</a>(),
  <a class="code" href="class_file_writer.html#aca52ee3a5dcc8649a1aa702ba6de6af6">_write_bufs</a>(),
  _free_bufs(),
  _state (IDLE),
  <a class="code" href="class_file_writer.html#a39285179310fa0e5424b9b53dd722f64" title="Mutex that protects the write buffer from multi-threaded access.">_write_bufs_mutex</a>(),
  <a class="code" href="class_file_writer.html#ac7364b6382201cccb01416a3db104ea5" title="Mutex that protects free list from multi-threaded access.">_free_bufs_mutex</a>(),
  <a class="code" href="class_file_writer.html#ae9cb41b36aa8ba14a5ead1f1b08272a2" title="The name of the file data will be written to.">_capture_file</a>(capture_file)
{
  <span class="keywordtype">void</span>* buf;
  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;write_blocks; i++) {
    <span class="keywordflow">if</span> (posix_memalign(&amp;buf, getpagesize(), write_block_size) != 0) {
      LOG4CXX_ERROR(logger, <span class="stringliteral">&quot;FileWriter buffer allocation failed.&quot;</span>);
      <span class="keywordflow">throw</span> std::string(<span class="stringliteral">&quot;Memalign failed.&quot;</span>);
    }
    _free_bufs.push_back(static_cast&lt;boost::uint8_t*&gt;(buf));
  }
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad0a98ab099aaca2f64875ace82fadd55"></a><!-- doxytag: member="FileWriter::cmd_stop" ref="ad0a98ab099aaca2f64875ace82fadd55" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileWriter::cmd_stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>External API command. Insert a STOP command into the object's command queue for processing. </p>

<p>Implements <a class="el" href="class_threaded.html#a52a40998cd6f4b995ceaba12899b4212">Threaded</a>.</p>

<p>Definition at line <a class="el" href="file__writer_8cc_source.html#l00132">132</a> of file <a class="el" href="file__writer_8cc_source.html">file_writer.cc</a>.</p>
<div class="fragment"><pre class="fragment">                          {
  LOG4CXX_INFO(logger, <span class="stringliteral">&quot;Received STOP&quot;</span>);
  _state = STOP;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a54470d110cd9e50add4a18808ef162cf"></a><!-- doxytag: member="FileWriter::cmd_write_to_disk" ref="a54470d110cd9e50add4a18808ef162cf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileWriter::cmd_write_to_disk </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>External API command. Insert a WRITE_TO_DISK command into the object's command queue for processing. </p>

<p>Definition at line <a class="el" href="file__writer_8cc_source.html#l00137">137</a> of file <a class="el" href="file__writer_8cc_source.html">file_writer.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                   {
  LOG4CXX_INFO(logger, <span class="stringliteral">&quot;Received WRITE_TO_DISK&quot;</span>);
  _state = WRITE_TO_DISK;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aad41d68744863310432de1b9e046023c"></a><!-- doxytag: member="FileWriter::handle_stop" ref="aad41d68744863310432de1b9e046023c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileWriter::handle_stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Command handler. Handles the STOP command/state. On receiving this command, the <a class="el" href="class_file_writer.html">FileWriter</a> object will stop processing and exit the <a class="el" href="class_file_writer.html#adef323aa1b01c54dcdf26a7c67ba0360" title="Main processing loop.">run()</a> method at the next opportunity. </p>

<p>Implements <a class="el" href="class_threaded.html#a421b31c46443970af90b8fa1df8ea141">Threaded</a>.</p>

<p>Definition at line <a class="el" href="file__writer_8cc_source.html#l00142">142</a> of file <a class="el" href="file__writer_8cc_source.html">file_writer.cc</a>.</p>
<div class="fragment"><pre class="fragment">                             {
  <a class="code" href="class_threaded.html#a96b6bd60b0eb14d91ea26b1eac61064c">_running</a> = <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab70890152eb8fc3cfd06fb9481ea9cd0"></a><!-- doxytag: member="FileWriter::handle_write_to_disk" ref="ab70890152eb8fc3cfd06fb9481ea9cd0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileWriter::handle_write_to_disk </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Command handler. Handles the WRITE_TO_DISK command/state. On receiving this command, the <a class="el" href="class_file_writer.html">FileWriter</a> object will start reading data from its internal buffers and writing them to disk. </p>

<p>Definition at line <a class="el" href="file__writer_8cc_source.html#l00150">150</a> of file <a class="el" href="file__writer_8cc_source.html">file_writer.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                      {
  <a class="code" href="class_file_writer.html#ae596120f6d887f38bcca891b31cfc441">write_block</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="aed0ee15de36255a2883b5f15c710848c"></a><!-- doxytag: member="FileWriter::write" ref="aed0ee15de36255a2883b5f15c710848c" args="(boost::uint8_t *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool FileWriter::write </td>
          <td>(</td>
          <td class="paramtype">boost::uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>External API. Write buffer to disk. The supplied buffer is stored in the internal buffer queue where it waits to be written to disk by the main processing loop. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>The buffer to be written to disk. </td></tr>
    <tr><td class="paramname">buf</td><td>Length of buffer to be written. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file__writer_8cc_source.html#l00238">238</a> of file <a class="el" href="file__writer_8cc_source.html">file_writer.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                      {
  boost::mutex::scoped_lock lock(<a class="code" href="class_file_writer.html#a39285179310fa0e5424b9b53dd722f64" title="Mutex that protects the write buffer from multi-threaded access.">_write_bufs_mutex</a>);
  <a class="code" href="class_file_writer.html#aca52ee3a5dcc8649a1aa702ba6de6af6">_write_bufs</a>.push_back(b);
  <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae596120f6d887f38bcca891b31cfc441"></a><!-- doxytag: member="FileWriter::write_block" ref="ae596120f6d887f38bcca891b31cfc441" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FileWriter::write_block </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Writes a block to disk using the specified file descriptor. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The file descriptor to which the data will be sent. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file__writer_8cc_source.html#l00244">244</a> of file <a class="el" href="file__writer_8cc_source.html">file_writer.cc</a>.</p>
<div class="fragment"><pre class="fragment">                             {
  boost::uint8_t* buf;
  boost::uint64_t buf_len;
  <span class="keywordflow">if</span> (<a class="code" href="class_file_writer.html#aca52ee3a5dcc8649a1aa702ba6de6af6">_write_bufs</a>.empty()) {
    <span class="keywordflow">return</span>;
  } <span class="keywordflow">else</span> {
    boost::mutex::scoped_lock lock(<a class="code" href="class_file_writer.html#a39285179310fa0e5424b9b53dd722f64" title="Mutex that protects the write buffer from multi-threaded access.">_write_bufs_mutex</a>);
    buf = <a class="code" href="class_file_writer.html#aca52ee3a5dcc8649a1aa702ba6de6af6">_write_bufs</a>.front();
    buf_len = <a class="code" href="class_file_writer.html#aca52ee3a5dcc8649a1aa702ba6de6af6">_write_bufs</a>.size();
    <a class="code" href="class_file_writer.html#aca52ee3a5dcc8649a1aa702ba6de6af6">_write_bufs</a>.pop_front();
  }

  <span class="comment">// Write buffer to disk.</span>
  <span class="keywordtype">int</span> bytes_left = <a class="code" href="class_file_writer.html#aedf3b9551969f84ce150d464cab00f84" title="The size of blocks to be written to disc.">_WRITE_BLOCK_SIZE</a>;
  <span class="keywordtype">int</span> bytes_written = 0;
  <span class="keywordflow">while</span> (bytes_left) {
    <span class="keywordtype">int</span> nb =<a class="code" href="class_file_writer.html#aed0ee15de36255a2883b5f15c710848c"> ::write</a>(<a class="code" href="class_file_writer.html#a823e30da8d24cec85a15bb8947ec7d26" title="Encapsulates the file descriptor of the file this object manages.">_pfd</a>.fd, &amp;buf[bytes_written], bytes_left);
    <span class="keywordflow">if</span> (nb &gt; 0) {
      bytes_left -= nb;
      bytes_written += nb;
    } <span class="keywordflow">else</span> {
      LOG4CXX_ERROR(logger, <span class="stringliteral">&quot;Write error: &quot;</span> &lt;&lt; strerror(errno));
    }
  }
  <span class="keywordflow">if</span> (<a class="code" href="class_file_writer.html#a77bde646bee4389994613ae0663a13ca">_sw</a>)
    <a class="code" href="class_file_writer.html#a77bde646bee4389994613ae0663a13ca">_sw</a>-&gt;<a class="code" href="class_stats_writer.html#a7b73b711a050b4bd17fe7489db8231d4">update</a>(1, bytes_written, 0, buf_len);
  free_buffer(buf);
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a094970dbaba07c145b26b9fce12951e8"></a><!-- doxytag: member="FileWriter::_read_cond" ref="a094970dbaba07c145b26b9fce12951e8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::condition_variable <a class="el" href="class_file_writer.html#a094970dbaba07c145b26b9fce12951e8">FileWriter::_read_cond</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Condition variable that signals blocked readers (i.e. pop() operations) when a new buffer is re-inserted back into the pool. </p>

<p>Definition at line <a class="el" href="file__writer_8h_source.html#l00155">155</a> of file <a class="el" href="file__writer_8h_source.html">file_writer.h</a>.</p>

</div>
</div>
<a class="anchor" id="a77bde646bee4389994613ae0663a13ca"></a><!-- doxytag: member="FileWriter::_sw" ref="a77bde646bee4389994613ae0663a13ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_stats_writer.html">StatsWriter</a>* const <a class="el" href="class_file_writer.html#a77bde646bee4389994613ae0663a13ca">FileWriter::_sw</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reference to statistics writer object for capturing throughput statistics to CSV file. </p>

<p>Definition at line <a class="el" href="file__writer_8h_source.html#l00166">166</a> of file <a class="el" href="file__writer_8h_source.html">file_writer.h</a>.</p>

</div>
</div>
<a class="anchor" id="aca52ee3a5dcc8649a1aa702ba6de6af6"></a><!-- doxytag: member="FileWriter::_write_bufs" ref="aca52ee3a5dcc8649a1aa702ba6de6af6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt;boost::uint8_t*&gt; <a class="el" href="class_file_writer.html#aca52ee3a5dcc8649a1aa702ba6de6af6">FileWriter::_write_bufs</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A circular buffer that contains all of the buffers waiting to be written to disk. </p>

<p>Definition at line <a class="el" href="file__writer_8h_source.html#l00140">140</a> of file <a class="el" href="file__writer_8h_source.html">file_writer.h</a>.</p>

</div>
</div>
<a class="anchor" id="af0d0e6ad7c4b2f7ce920540728fbcb20"></a><!-- doxytag: member="FileWriter::_write_cond" ref="af0d0e6ad7c4b2f7ce920540728fbcb20" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::condition_variable <a class="el" href="class_file_writer.html#af0d0e6ad7c4b2f7ce920540728fbcb20">FileWriter::_write_cond</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Condition variable that signals blocked writers (i.e. push() operations) when a new buffer is popped from the pool. </p>

<p>Definition at line <a class="el" href="file__writer_8h_source.html#l00159">159</a> of file <a class="el" href="file__writer_8h_source.html">file_writer.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/net2disk/<a class="el" href="file__writer_8h_source.html">file_writer.h</a></li>
<li>src/net2disk/<a class="el" href="file__writer_8cc_source.html">file_writer.cc</a></li>
</ul>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Sep 28 2011 14:20:35 for Mark6 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
